node {
    def app

    stage('Clone repository') {
        checkout scm
    }

    stage('Build image') {

        app = docker.build("medch1/simpleapp", " .")
    }



    stage('Snyk') {
        script {

            withCredentials([string(credentialsId: 'snyk_secret_token', variable: 'SNYK_TOKEN')]) {
                sh 'snyk auth $SNYK_TOKEN'
            }
            def variable = sh(script:'snyk container test registry.hub.docker.com/medch1/simpleapp --severity-threshold=critical', returnStatus: true)

            echo "error code = ${variable}"

        }
    }


}
