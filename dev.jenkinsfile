pipeline {
    agent any
    stages {
        stage('Clone repository') {
            checkout scm
        }

        stage('Build image') {

            app = docker.build("medch1/simpleapp", " .")
        }



        stage('Scan container') {

            withCredentials([string(credentialsId: 'snyk_secret_token', variable: 'SNYK_TOKEN')]) {
                sh 'snyk auth $SNYK_TOKEN'
            }
            sh 'snyk test'

        }
    }
}
